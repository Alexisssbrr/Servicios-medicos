@model IEnumerable<ServicioMedico.Models.VisitaMedica>

@{
    ViewData["Title"] = "Directorio de Alumnos";
}

<div class="container mt-5">
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="input-group mb-4 shadow-sm">
                    <span class="input-group-text bg-white border-end-0">
                        <i class="bi bi-search"></i> 🔍
                    </span>
                    <input type="text" id="buscadorAlumno" class="form-control border-start-0 ps-0"
                           placeholder="Buscar por nombre o matrícula..."
                           onkeyup="filtrarAlumnos()">
                </div>
            </div>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-4" id="contenedorTarjetas">
        
        @if (!Model.Any())
        {
            <div class="col-12 text-center">
                <p class="text-muted">No hay alumnos registrados aún.</p>
                <a asp-action="Register" class="btn btn-primary">Registrar Nuevo</a>
            </div>
        }

        @foreach (var alumno in Model)
        {
            <div class="col tarjeta-alumno">
                <div class="card h-100 shadow-sm border-0 pt-3">
                    <div class="text-center">
                        <img src="@($"https://i.pravatar.cc/150?u={alumno.Matricula}")" class="rounded-circle border" style="width: 100px; height: 100px;" alt="Alumno">
                    </div>
                    <div class="card-body text-center">
                        <h6 class="card-title mb-1">@alumno.NombreCompleto</h6>
                        <p class="text-muted x-small mb-2">Mat: <span class="dato-matricula">@alumno.Matricula</span></p>
                        
                        <span class="badge bg-info text-dark" style="font-size: 0.7rem;">@alumno.Carrera</span>
                        <hr>

                        <a class="btn btn-sm btn-outline-primary w-100"
                           asp-controller="Home"
                           asp-action="History"
                           asp-route-id="@alumno.Matricula">
                            Ver Historial
                        </a>
                    </div>
                </div>
            </div>
        }

    </div>
</div>

<script>
    function filtrarAlumnos() {
        let filtro = document.getElementById('buscadorAlumno').value.toLowerCase();
        let tarjetas = document.querySelectorAll('.tarjeta-alumno');

        tarjetas.forEach(tarjeta => {
            let nombre = tarjeta.querySelector('.card-title').innerText.toLowerCase();
            let matricula = tarjeta.querySelector('.dato-matricula').innerText.toLowerCase();

            if (nombre.includes(filtro) || matricula.includes(filtro)) {
                tarjeta.style.display = "";
            } else {
                tarjeta.style.display = "none";
            }
        });
    }
</script>